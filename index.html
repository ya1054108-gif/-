<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥µç°¡å‹¤å‹™ç´€éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f3f4f6; }
        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* æ•‘è­·é¡åˆ¥æŒ‰éˆ•é¸ä¸­æ¨£å¼ */
        .ems-btn.selected { background-color: #10b981; color: white; border-color: #10b981; }
    </style>
</head>
<body class="pb-20">

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <div class="bg-slate-800 text-white p-4 sticky top-0 z-50 shadow text-center text-lg font-bold">
        å‹¤å‹™ç´€éŒ„ç°¿
    </div>

    <!-- 1. é¦–é  (Home View) -->
    <div id="viewHome" class="view-section active container mx-auto p-4 max-w-md">
        <div class="grid grid-cols-2 gap-4 h-48 mb-6">
            <!-- ç«è­¦æŒ‰éˆ• -->
            <button onclick="switchView('viewFire')" class="bg-red-600 text-white rounded-2xl shadow-lg flex flex-col items-center justify-center gap-2 hover:bg-red-700 active:scale-95 transition">
                <i class="fa-solid fa-fire text-4xl"></i>
                <span class="text-2xl font-bold">ç«è­¦</span>
            </button>
            <!-- æ•‘è­·æŒ‰éˆ• -->
            <button onclick="switchView('viewEms')" class="bg-emerald-600 text-white rounded-2xl shadow-lg flex flex-col items-center justify-center gap-2 hover:bg-emerald-700 active:scale-95 transition">
                <i class="fa-solid fa-truck-medical text-4xl"></i>
                <span class="text-2xl font-bold">æ•‘è­·</span>
            </button>
        </div>

        <!-- æ­·å²ç´€éŒ„åˆ—è¡¨ -->
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-gray-500 font-bold">æœ€è¿‘ç´€éŒ„</h3>
            <button onclick="exportData()" class="text-xs text-blue-600 underline">å‚™ä»½è³‡æ–™</button>
        </div>
        <div id="historyList" class="space-y-3">
            <!-- JS è‡ªå‹•ç”Ÿæˆ -->
        </div>
    </div>

    <!-- 2. ç«è­¦è¡¨å–® (Fire View) -->
    <div id="viewFire" class="view-section container mx-auto p-4 max-w-md">
        <div class="bg-white rounded-xl shadow-lg p-5">
            <h2 class="text-xl font-bold text-red-600 mb-4 border-b pb-2">ğŸ”¥ æ–°å¢ç«è­¦ç´€éŒ„</h2>
            
            <form onsubmit="saveFire(event)" class="space-y-4">
                <div>
                    <label class="text-sm text-gray-500">æ—¥æœŸæ™‚é–“</label>
                    <input type="datetime-local" id="fireDate" required class="w-full p-3 bg-gray-50 border rounded-lg text-lg font-mono">
                </div>
                
                <div>
                    <label class="text-sm text-gray-500">åœ°é»</label>
                    <input type="text" id="fireLocation" placeholder="ä¾‹å¦‚ï¼šä¸­å±±è·¯100è™Ÿ" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 outline-none">
                </div>

                <div>
                    <label class="text-sm text-gray-500">å‡ºå‹¤è»Šè¼›</label>
                    <input type="text" id="fireVehicles" placeholder="ä¾‹å¦‚ï¼š11, 61, 91" class="w-full p-3 border rounded-lg outline-none">
                </div>

                <div>
                    <label class="text-sm text-gray-500">æ˜¯å¦æˆç½ / ç‹€æ³</label>
                    <select id="fireStatus" class="w-full p-3 border rounded-lg bg-white outline-none">
                        <option value="æˆç½">âœ… æˆç½ (æœ‰ç‡’)</option>
                        <option value="æœªæˆç½">âŒ æœªæˆç½</option>
                        <option value="èª¤å ±">âš ï¸ èª¤å ±/è¬Šå ±</option>
                        <option value="æŸ¥çœ‹">ğŸ‘€ æŸ¥çœ‹/å…¶ä»–</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button type="button" onclick="switchView('viewHome')" class="p-3 rounded-lg border text-gray-600">å–æ¶ˆ</button>
                    <button type="submit" class="p-3 rounded-lg bg-red-600 text-white font-bold">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 3. æ•‘è­·è¡¨å–® (EMS View) -->
    <div id="viewEms" class="view-section container mx-auto p-4 max-w-md">
        <div class="bg-white rounded-xl shadow-lg p-5">
            <h2 class="text-xl font-bold text-emerald-600 mb-4 border-b pb-2">ğŸš‘ æ–°å¢æ•‘è­·ç´€éŒ„</h2>
            
            <form onsubmit="saveEms(event)" class="space-y-4">
                <div>
                    <label class="text-sm text-gray-500">æ—¥æœŸæ™‚é–“</label>
                    <input type="datetime-local" id="emsDate" required class="w-full p-3 bg-gray-50 border rounded-lg text-lg font-mono">
                </div>

                <div>
                    <label class="text-sm text-gray-500">åœ°é»</label>
                    <input type="text" id="emsLocation" placeholder="åœ°é»..." required class="w-full p-3 border rounded-lg outline-none">
                </div>

                <div>
                    <label class="text-sm text-gray-500 mb-1 block">æ¡ˆä»¶ç¨®é¡</label>
                    <div class="grid grid-cols-3 gap-2" id="emsTypeContainer">
                        <!-- JS æœƒå¹«å¿™è™•ç†é»æ“Šè®Šè‰² -->
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">æ€¥ç—…</button>
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">è»Šç¦</button>
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">å‰µå‚·</button>
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">è·¯å€’</button>
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">æ€¥ç”¢</button>
                        <button type="button" onclick="selectType(this)" class="ems-btn p-2 border rounded text-sm text-gray-600">å…¶ä»–</button>
                    </div>
                    <input type="hidden" id="emsType" required> <!-- éš±è—æ¬„ä½å­˜å€¼ -->
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-sm text-gray-500">å ±æ¡ˆåŸå› /ä¸»è¨´</label>
                        <input type="text" id="emsReason" placeholder="å¦‚: èƒ¸ç—›" class="w-full p-3 border rounded-lg outline-none">
                    </div>
                    <div>
                        <label class="text-sm text-gray-500">é€å¾€é†«é™¢</label>
                        <input type="text" id="emsHospital" placeholder="å¦‚: å°å¤§" class="w-full p-3 border rounded-lg outline-none">
                    </div>
                </div>

                <div>
                    <label class="text-sm text-gray-500">å‚™è¨» (è™•ç½®/è€—æ)</label>
                    <textarea id="emsNote" rows="2" class="w-full p-3 border rounded-lg outline-none" placeholder="è™•ç½®é‡é»..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button type="button" onclick="switchView('viewHome')" class="p-3 rounded-lg border text-gray-600">å–æ¶ˆ</button>
                    <button type="submit" class="p-3 rounded-lg bg-emerald-600 text-white font-bold">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // è³‡æ–™å„²å­˜è®Šæ•¸
        let logs = JSON.parse(localStorage.getItem('simpleFireLogs')) || [];

        // åˆå§‹åŒ–
        window.onload = function() {
            renderHistory();
        }

        // åˆ‡æ›é é¢åŠŸèƒ½
        function switchView(viewId) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            // é¡¯ç¤ºç›®æ¨™é é¢
            document.getElementById(viewId).classList.add('active');

            // å¦‚æœæ˜¯æ‰“é–‹è¡¨å–®ï¼Œè‡ªå‹•å¡«å…¥ç¾åœ¨æ™‚é–“
            if(viewId === 'viewFire' || viewId === 'viewEms') {
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                const timeStr = now.toISOString().slice(0,16);
                
                if(viewId === 'viewFire') document.getElementById('fireDate').value = timeStr;
                if(viewId === 'viewEms') {
                    document.getElementById('emsDate').value = timeStr;
                    resetEmsButtons(); // é‡ç½®æ•‘è­·æŒ‰éˆ•
                }
            }
        }

        // æ•‘è­·é¡åˆ¥æŒ‰éˆ•é»æ“Šé‚è¼¯
        function selectType(btn) {
            // æ¸…é™¤å…¶ä»–æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.ems-btn').forEach(b => b.classList.remove('selected'));
            // è¨­å®šç•¶å‰æŒ‰éˆ•æ¨£å¼
            btn.classList.add('selected');
            // å¯«å…¥éš±è—æ¬„ä½
            document.getElementById('emsType').value = btn.innerText;
        }

        function resetEmsButtons() {
            document.querySelectorAll('.ems-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('emsType').value = '';
        }

        // å„²å­˜ç«è­¦
        function saveFire(e) {
            e.preventDefault();
            const log = {
                id: Date.now(),
                category: 'fire',
                date: document.getElementById('fireDate').value,
                location: document.getElementById('fireLocation').value,
                vehicles: document.getElementById('fireVehicles').value,
                status: document.getElementById('fireStatus').value,
                note: '' // ç«è­¦ç›®å‰æ²’å‚™è¨»æ¬„ä½ï¼Œç•™ç©ºæˆ–ä»¥å¾Œæ“´å……
            };
            saveToLocal(log);
        }

        // å„²å­˜æ•‘è­·
        function saveEms(e) {
            e.preventDefault();
            // æª¢æŸ¥æœ‰æ²’æœ‰é¸é¡åˆ¥
            const type = document.getElementById('emsType').value;
            if(!type) { alert('è«‹é¸æ“‡æ¡ˆä»¶ç¨®é¡'); return; }

            const log = {
                id: Date.now(),
                category: 'ems',
                date: document.getElementById('emsDate').value,
                location: document.getElementById('emsLocation').value,
                subType: type,
                reason: document.getElementById('emsReason').value,
                hospital: document.getElementById('emsHospital').value,
                note: document.getElementById('emsNote').value
            };
            saveToLocal(log);
        }

        // å¯«å…¥è³‡æ–™åº«ä¸¦å›åˆ°é¦–é 
        function saveToLocal(log) {
            logs.unshift(log); // åŠ åœ¨æœ€å‰é¢
            localStorage.setItem('simpleFireLogs', JSON.stringify(logs));
            
            // æ¸…ç©ºè¡¨å–®
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.querySelectorAll('textarea').forEach(i => i.value = '');
            
            renderHistory();
            switchView('viewHome');
        }

        // åˆªé™¤
        function deleteLog(id) {
            if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                logs = logs.filter(l => l.id !== id);
                localStorage.setItem('simpleFireLogs', JSON.stringify(logs));
                renderHistory();
            }
        }

        // æ¸²æŸ“æ­·å²ç´€éŒ„
        function renderHistory() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';

            if(logs.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-4">å°šç„¡ç´€éŒ„</div>';
                return;
            }

            logs.forEach(log => {
                const dateObj = new Date(log.date);
                const dateStr = `${dateObj.getMonth()+1}/${dateObj.getDate()} ${dateObj.getHours().toString().padStart(2,'0')}:${dateObj.getMinutes().toString().padStart(2,'0')}`;
                
                let html = '';
                
                if(log.category === 'fire') {
                    html = `
                        <div class="bg-white p-3 rounded-lg shadow border-l-4 border-red-500 relative">
                            <button onclick="deleteLog(${log.id})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded">ç«è­¦</span>
                                <span class="text-sm font-bold text-gray-700">${dateStr}</span>
                            </div>
                            <div class="text-lg font-bold mb-1">${log.location}</div>
                            <div class="text-sm text-gray-600">
                                <span><i class="fa-solid fa-truck"></i> ${log.vehicles || 'ç„¡ç´€éŒ„'}</span>
                                <span class="mx-1">|</span>
                                <span class="${log.status === 'æˆç½' ? 'text-red-600 font-bold' : 'text-gray-500'}">${log.status}</span>
                            </div>
                        </div>
                    `;
                } else {
                    html = `
                        <div class="bg-white p-3 rounded-lg shadow border-l-4 border-emerald-500 relative">
                            <button onclick="deleteLog(${log.id})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-1 rounded">æ•‘è­· - ${log.subType}</span>
                                <span class="text-sm font-bold text-gray-700">${dateStr}</span>
                            </div>
                            <div class="text-lg font-bold mb-1">${log.location}</div>
                            <div class="text-sm text-gray-600 mb-1">
                                ä¸»è¨´: <b>${log.reason || '-'}</b> â®• ${log.hospital || 'æœªé€é†«'}
                            </div>
                            ${log.note ? `<div class="text-xs text-gray-500 bg-gray-50 p-1 rounded mt-1">${log.note}</div>` : ''}
                        </div>
                    `;
                }
                container.innerHTML += html;
            });
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs));
            const a = document.createElement('a');
            a.setAttribute("href", dataStr);
            a.setAttribute("download", "å‹¤å‹™å‚™ä»½.json");
            document.body.appendChild(a);
            a.click();
            a.remove();
        }
    </script>
</body>
</html>
